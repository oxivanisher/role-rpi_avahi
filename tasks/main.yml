---
# tasks file for rpi_avahi

- name: Disable avahi
  when: rpi_avahi_disable | bool
  become: true
  become_user: root
  block:
    - name: Disable avahi socket
      ansible.builtin.systemd:
        name: avahi-daemon.socket
        state: stopped
        enabled: false
        masked: true

    - name: Stop and disable avahi service
      ansible.builtin.systemd:
        name: avahi-daemon.service
        state: stopped
        enabled: false
        masked: true

- name: Enable avahi
  when: not rpi_avahi_disable | bool
  become: true
  become_user: root
  block:
    - name: Unmask avahi service
      ansible.builtin.systemd:
        name: avahi-daemon.service
        masked: false

    - name: Unmask avahi socket
      ansible.builtin.systemd:
        name: avahi-daemon.socket
        masked: false

    - name: Start and enable avahi service
      ansible.builtin.systemd:
        name: avahi-daemon.service
        state: started
        enabled: true

    - name: Enable avahi socket
      ansible.builtin.systemd:
        name: avahi-daemon.socket
        state: started
        enabled: true
